
<!--検索ransack--->
<h4><strong>検索フォーム</strong></h4>
<%= search_form_for @q, html: { class: "form-inline" } do |f| %>
<div class="form-group" style="width: 18rem;">
  <%= f.label :food_name_cont, '食品名を入力してください' %>
  <%= f.search_field :food_name_cont, placeholder: '食品名', id: 'food_name-form', class: "form-control mr-3"  %>
</div>

<div class="form-group" style="width: 18rem;">
  <%= f.label :use_up_on_gteq, '賞味期限が選択日付以降' %>
  <%= f.date_field :use_up_on_gteq, class: "form-control mr-3" %>
</div>

<div class="form-group" style="width: 18rem;">
  <%= f.label :price_lteq, '入力価格以下で検索' %>
  <%= f.number_field :price_lteq, placeholder: '価格', id: 'price-form', class: "form-control mr-3"  %>
</div>

<div class="form-group" style="width: 6rem;">
<%= f.label :consumption_eq, '消費済み' %>
<%= f.check_box :consumption_eq, class: "form-control mr-3" %>
</div>

<br>
<div class="search-actions">
  <%= f.submit '検索', class: 'btn btn-primary' %>
</div>
<% end %>

<hr>

<!--------食品の登録----------->
<h4><strong>食品の登録</strong></h4>
<br>
<%= form_with(method: :get, url: food_stocks_path) do |form| %>

  <div class="form-group" style="width: 18rem;">
    <%= form.label :食品カテゴリ %>
    <%= form.collection_select :food_category_id, FoodCategory.all, :id, :name, { include_blank: "カテゴリを選択してください"}, class: "form-control mr-3" %>
  </div>

  <div class="actions">
    <%= form.submit '絞り込む'%>
  </div>
<% end %>


<%= form_with(model: @food_stock) do |form| %>
  <% if @food_stock.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@food_stock.errors.count, "error") %> prohibited this food_stock from being saved:</h2>

      <ul>
        <% @food_stock.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>


  <%= form.collection_select :food_id, @food_select_lists, :id, :name, { include_blank: "食品を選択してください"} %>
  <div class="form-group" style="width: 18rem;">
    <%= form.label :賞味期限 %>
    <%= form.date_field :use_up_on, class: "form-control mr-3" %>
  </div>

  <div class="form-group" style="width: 18rem;">
    <%= form.label :価格 %>
    <%= form.number_field :price, placeholder: '価格', id: 'price-form', class: "form-control mr-3" %>
  </div>

  <div class="form-group" style="width: 18rem;">
    <%= form.label :消費の有無 %>
    <%= form.check_box :consumption %>
  </div>

  <div class="form-group" style="width: 18rem;">
    <%= form.label :備考欄 %>
    <%= form.text_field :notes, placeholder: 'メモがあれば入力', id: 'notes-form', class: "form-control mr-3" %>
  </div>

  <div class="submit-actions">
    <%= form.submit %>
  </div>
<% end %>

<!--------冷蔵庫食品一覧--------->
<table class="table">
  <thead class="thead-light">
    <tr>
      <th scope="col">食品カテゴリ</th>
      <th scope="col"><%= sort_link(@q, :food_name, "食品名") %></th>
      <th scope="col"><%= sort_link(@q, :use_up_on, "賞味期限") %></th>
      <th scope="col"><%= sort_link(@q, :price, "価格") %></th>
      <th scope="col"><%= sort_link(@q, :consumption, "消費の有無") %></th>
      <th scope="col">備考欄</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @food_stocks.each do |food_stock| %>
      <tr>
        <td><%= food_stock.food.food_category.name %></td>
        <td><%= food_stock.food.name %></td>
        <td><%= food_stock.use_up_on %></td>
        <td><%= "#{food_stock.price}円 "%></td>
        <td><%= food_stock.consumption %></td>
        <td><%= food_stock.notes %></td>
        <td><%= link_to '食品詳細', food_stock %></td>
        <td><%= link_to '食品編集', edit_food_stock_path(food_stock) %></td>
        <td><%= link_to '削除', food_stock, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>




<br>
<!--以下追記 カレンダー実装の為-->
<div class="col-md-8">
  <%= month_calendar events: @food_stocks do |date, food_stocks| %>
    <%= date.day %>

    <% food_stocks.each do |food_stock| %>
      <% if food_stock.use_up_on <= @three_days_before %><!--賞味期限から数えて、残り3日の食材は赤く表記される 2/18実装--->
        <div>
          <%= link_to food_stock.food.name, food_stock, style: "color: red" %>
        </div>
      <% else %>
        <div>
          <%= link_to food_stock.food.name, food_stock %>
        </div>
      <% end %>
    <% end %>
  <% end %>
</div>
